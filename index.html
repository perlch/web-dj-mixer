<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>DJ Loop</title>
  <style>
    body {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
      background-color: #181818;
      color: white;
    }

    #controls {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }

    .loopBtn {
      padding: 15px 25px;
      margin: 5px;
      font-size: 18px;
      cursor: pointer;
      color: white;
      user-select: none;
      background-color: #444;
      border: 2px solid #fff;
      border-radius: 5px;
      transition: background-color 0.2s;
    }

    .loopBtn:active {
      background-color: #666;
    }
    
  </style>
</head>
<body>

  <audio id="track" src="YOUR_FILE.mp3" preload="auto" controls></audio>

  <div id="controls">
    <!-- <button class="loopBtn" data-loop="2">1/2</button>
    <button class="loopBtn" data-loop="4">1/4</button>
    <button class="loopBtn" data-loop="8">1/8</button>
    <button class="loopBtn" data-loop="16">1/16</button>
    <button class="loopBtn" data-loop="3">1/3</button> -->

    <!-- I DID THIS BECAUSE OF WEB DELAY -->
    <button class="loopBtn" data-loop="3">1/2</button>
    <button class="loopBtn" data-loop="6">1/4</button>
    <button class="loopBtn" data-loop="12">1/8</button>
    <button class="loopBtn" data-loop="24">1/16</button>
    <!-- <button class="loopBtn" data-loop="9">1/3</button> -->
  </div>

  <script>
    const audio = document.getElementById('track');
    const loopBtns = document.querySelectorAll('.loopBtn');

 
    const bpm = 128; 
    const beatDuration = 60 / bpm;

    let loopStart = 0;
    let isLooping = false;
    let loopTime = 0; 
    let loopInterval = null;
    let loopFactor = 4; 

    
    loopBtns.forEach(btn => {
      btn.addEventListener('pointerdown', (e) => {
        e.preventDefault();
        loopFactor = parseInt(btn.getAttribute('data-loop'), 10); 
        loopStart = audio.currentTime;
        loopTime = 0;
        isLooping = true;

        // Запускаем отсчёт времени удержания
        loopInterval = setInterval(() => {
          loopTime += 0.01;
        }, 10);

        requestAnimationFrame(loopFrame); 
      });

     
      btn.addEventListener('pointerup', stopLooping);
    });

    
    function loopFrame() {
      if (!isLooping) return;

      const now = audio.currentTime;
      const loopLength = beatDuration / loopFactor;

      if (now - loopStart >= loopLength) {
        audio.currentTime = loopStart; 
        audio.play();
      }

      requestAnimationFrame(loopFrame); 
    }

   
    function stopLooping() {
      isLooping = false;
      clearInterval(loopInterval);
      audio.currentTime += loopTime; 
      audio.play();
    }
  </script>

</body>
</html>
